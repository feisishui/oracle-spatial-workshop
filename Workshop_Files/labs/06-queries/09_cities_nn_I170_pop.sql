-- Nearest cities to I170 per population - BADSELECT c.city, c.state_abrv, c.pop90  FROM us_interstates i,       us_cities c WHERE i.interstate = 'I170'   AND sdo_nn (c.location, i.geom,'sdo_num_res=5') = 'TRUE'   AND pop90 > 300000;-- Using a subquery: the optimizer merges it in the main query: still wrong resultSELECT c.city, c.state_abrv, c.pop90  FROM us_interstates i,       (select * from us_cities where pop90 > 300000) c WHERE i.interstate = 'I170'   AND sdo_nn (c.location, i.geom,'sdo_num_res=5') = 'TRUE';-- Using a subquery, but prevent the optimizer from merging it: this fails-- ORA-13249: SDO_NN cannot be evaluated without using indexSELECT /*+ NO_MERGE(c) */ c.city, c.state_abrv, c.pop90  FROM us_interstates i,       (select * from us_cities where pop90 > 300000) c WHERE i.interstate = 'I170'   AND sdo_nn (c.location, i.geom,'sdo_num_res=5') = 'TRUE';-- Nearest cities to I170 per population - GOODSELECT c.city, c.state_abrv, c.pop90  FROM us_interstates i,       us_cities c WHERE i.interstate = 'I170'   AND sdo_nn (c.location, i.geom) = 'TRUE'   AND pop90 > 300000   AND ROWNUM <= 5;-- Nearest cities to I170 per population with distance (results automatically ordered by distance)SELECT  c.city, c.state_abrv, c.pop90,       sdo_nn_distance (1) distance_in_miles  FROM us_interstates i,       us_cities c WHERE i.interstate = 'I170'   AND sdo_nn (c.location, i.geom, 'unit=mile', 1)       = 'TRUE'   AND pop90 > 300000   AND ROWNUM <= 5;-- Nearest cities to I170 per population limited by distance (10g)SELECT c.city, c.state_abrv, c.pop90,       sdo_nn_distance (1) distance_in_miles  FROM us_interstates i,       us_cities c WHERE i.interstate = 'I170'   AND sdo_nn (c.location, i.geom, 'sdo_batch_size=0, unit=mile', 1) = 'TRUE'   AND pop90 > 300000   AND sdo_nn_distance (1)  <= 230   AND ROWNUM <= 5;-- Nearest cities to I170 per population limited by distance (11g)SELECT c.city, c.state_abrv, c.pop90  FROM us_interstates i,       us_cities c WHERE i.interstate = 'I170'   AND sdo_nn (c.location, i.geom,         'sdo_batch_size=0, unit=mile distance=230', 1       ) = 'TRUE'   AND pop90 > 300000   AND ROWNUM <= 5;
